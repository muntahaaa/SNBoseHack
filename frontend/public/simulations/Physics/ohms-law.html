<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohm's Law AR Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: auto;
            background-color: #f5f5f5;
            position: relative; /* Added for back button positioning */
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .top-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .equation {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }
        
        .variable-v {
            color: blue;
            transition: font-size 0.3s ease;
        }
        
        .variable-i {
            color: orange;
            transition: font-size 0.3s ease;
        }
        
        .variable-r {
            color: blue;
            transition: font-size 0.3s ease;
        }
        
        .controls {
            display: flex;
            gap: 40px;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 10px;
            background-color: white;
        }
        
        .control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .control-label {
            font-weight: bold;
            font-size: 18px;
        }
        
        .control-description {
            font-size: 14px;
            text-align: center;
        }
        
        .slider-container {
            height: 180px;
            width: 30px;
            background-color: #f0f0f0;
            border-radius: 15px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slider-track {
            height: 130px;
            width: 4px;
            background-color: #ddd;
            border-radius: 2px;
        }
        
        .slider-handle {
            width: 30px;
            height: 15px;
            background-color: #aaa;
            border-radius: 5px;
            position: absolute;
            cursor: pointer;
            transform: translateY(50%);
        }
        
        .value {
            margin-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }
        
        .circuit {
            position: relative;
            width: 100%;
            height: 250px;
            margin-top: 20px;
            border: 3px solid #000;
            border-radius: 10px;
            background-color: #fff;
        }
        
        .battery-container {
            position: absolute;
            top: 12%;
            left: 18%;
            display: flex;
        }
        
        .battery {
            width: 50px;
            height: 30px;
            background: linear-gradient(to right, #888, #ccc);
            border: 1px solid #666;
            border-radius: 3px;
            margin-right: 2px;
        }
        
        .resistor-container {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .resistor {
            width: 200px;
            height: 40px;
            background: linear-gradient(to right, #ff9999, #ffcccc);
            border-radius: 20px;
            border: 1px solid #ff6666;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .resistor::after {
            content: "";
            position: absolute;
            width: 90%;
            height: 80%;
            background-image: radial-gradient(circle, #000 1px, transparent 1px);
            background-size: 10px 10px;
            opacity: 0.3;
        }
        
        .wire {
            position: absolute;
            background-color: #000;
        }
        
        .wire-top {
            width: 80%;
            height: 3px;
            top: 18%;
            left: 10%;
        }
        
        .wire-left {
            width: 3px;
            height: 60%;
            top: 18%;
            left: 10%;
        }
        
        .wire-right {
            width: 3px;
            height: 60%;
            top: 18%;
            right: 10%;
        }
        
        .wire-bottom {
            width: 80%;
            height: 3px;
            bottom: 20%;
            left: 10%;
        }
        
        .current-display {
            position: absolute;
            top: 44%;
            left: 50%;
            transform: translateX(-50%);
            padding: 5px 15px;
            background-color: white;
            border: 2px solid #333;
            border-radius: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .current-value {
            color: orange;
            font-size: 18px;
        }
        
        .current-flow {
            position: absolute;
            width: 50px;
            height: 50px;
            bottom: 8%;
            left: 5%;
            color: orange;
            font-size: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .current-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-top: 20px solid transparent;
            border-bottom: 20px solid transparent;
            border-left: 30px solid orange;
            transform-origin: center;
            opacity: 0;
        }
        
        .quiz-container {
            display: none;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .quiz-question {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .quiz-option {
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .quiz-option:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .quiz-option.selected {
            background-color: rgba(33, 150, 243, 0.5);
            border-color: #2196f3;
        }
        
        .quiz-option.correct {
            background-color: rgba(76, 175, 80, 0.5);
            border-color: #4caf50;
        }
        
        .quiz-option.incorrect {
            background-color: rgba(244, 67, 54, 0.5);
            border-color: #f44336;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .quiz-btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        .quiz-btn:hover {
            background-color: #3e8e41;
        }
        
        .quiz-btn:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        
        .explanation {
            display: none;
            font-size: 14px;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .scoreboard {
            display: none;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .title {
            position: absolute;
            bottom: 4%;
            left: 2%;
            font-size: 20px;
            font-weight: bold;
        }
        
        .refresh-btn {
            position: absolute;
            bottom: 4%;
            right: 2%;
            width: 40px;
            height: 40px;
            background-color: #ff9933;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            border: 2px solid #ff8800;
        }
        
        .quiz-toggle-btn {
            margin: 10px auto;
            padding: 10px 20px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .quiz-toggle-btn:hover {
            background-color: #555;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #2c5aa0;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background-color: #1c4277;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .back-button:before {
            content: "←";
            margin-right: 8px;
            font-size: 18px;
        }

        #learnButton {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
        }

        #learnButton:hover {
            background-color: #45a049;
        }

        #popup {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        #popup button {
            background-color: #f44336;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            margin-left: auto;
        }

        #popup button:hover {
            background-color: #d32f2f;
        }
        
        @keyframes moveArrow {
            0% { left: 20%; opacity: 0.8; }
            50% { left: 70%; opacity: 0.8; }
            51% { opacity: 0; }
            100% { left: 20%; opacity: 0; }
        }
        
        @media (max-width: 600px) {
            .top-section {
                flex-direction: column;
                align-items: center;
            }
            
            .controls {
                flex-direction: column;
                gap: 20px;
            }
            
            .circuit {
                height: 300px;
            }
            
            .quiz-options {
                grid-template-columns: 1fr;
            }
            
            .battery-container {
                left: 10%;
            }
            
            .resistor-container {
                width: 150px;
            }
            
            .resistor {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <button id="learnButton" style="position: fixed; bottom: 40px; right: 60px; z-index: 1000;">এসো ওহমের সূত্র শিখি</button>
    <button class="back-button" onclick="window.close()">Back to Physics Page</button>
    <div class="container">
        <div class="top-section">
            <div class="equation" role="math" aria-label="Ohm's Law equation: V equals I times R">
                <span class="variable-v" id="var-v">V</span>
                <span>=</span>
                <span class="variable-i" id="var-i">I</span>
                <span class="variable-r" id="var-r">R</span>
            </div>
            
            <div class="controls">
                <div class="control">
                    <div class="control-label">V</div>
                    <div class="control-description">voltage</div>
                    <div class="slider-container" id="voltage-slider" role="slider" aria-label="Voltage slider" aria-valuemin="0.5" aria-valuemax="10" aria-valuenow="4.5">
                        <div class="slider-track"></div>
                        <div class="slider-handle" id="voltage-handle" tabindex="0"></div>
                    </div>
                    <div class="value"><span id="voltage-value">4.5</span> V</div>
                </div>
                
                <div class="control">
                    <div class="control-label">R</div>
                    <div class="control-description">resistance</div>
                    <div class="slider-container" id="resistance-slider" role="slider" aria-label="Resistance slider" aria-valuemin="10" aria-valuemax="1000" aria-valuenow="78">
                        <div class="slider-track"></div>
                        <div class="slider-handle" id="resistance-handle" tabindex="0"></div>
                    </div>
                    <div class="value"><span id="resistance-value">78</span> Ω</div>
                </div>
            </div>
        </div>
        
        <div class="scoreboard" id="scoreboard" role="status">
            Score: <span id="score">0</span>
        </div>
        
        <div class="quiz-container" id="quiz-container">
            <div class="quiz-question" id="quiz-question"></div>
            <div class="quiz-options" id="quiz-options" role="radiogroup"></div>
            <div class="explanation" id="explanation"></div>
            <div class="quiz-controls">
                <button class="quiz-btn" id="check-answer" disabled aria-label="Check selected answer">Check Answer</button>
                <button class="quiz-btn" id="next-question" style="display: none;" aria-label="Proceed to next question">Next Question</button>
            </div>
        </div>
        
        <div class="circuit" role="img" aria-label="Circuit diagram">
            <div class="wire wire-top"></div>
            <div class="wire wire-left"></div>
            <div class="wire wire-right"></div>
            <div class="wire wire-bottom"></div>
            
            <div class="battery-container">
                <div class="battery"></div>
                <div class="battery"></div>
                <div class="battery"></div>
            </div>
            
            <div class="resistor-container">
                <div class="resistor" id="resistor"></div>
            </div>
            
            <div class="current-display">
                current = <span class="current-value" id="current-value">57.7</span> mA
            </div>
            
            <div class="current-flow" id="current-flow">
                <div class="current-arrow" id="arrow1"></div>
                <div class="current-arrow" id="arrow2"></div>
            </div>
            
            <div class="title">Ohm's Law</div>
            
            <div class="refresh-btn" role="button" aria-label="Reset simulation" tabindex="0">↻</div>
        </div>
        
        <button class="quiz-toggle-btn" id="quiz-toggle-btn" aria-label="Toggle quiz mode">Quiz Mode: Off</button>
    </div>

    <script>
        // Initial values
        let voltage = 4.5;
        let resistance = 78;
        let current = voltage / resistance * 1000; // in mA
        let isQuizMode = false;
        let score = 0;
        let selectedOptionIndex = null;
        let correctAnswer = null;
        let optionElements = [];
        
        // DOM elements
        const voltageSlider = document.getElementById('voltage-slider');
        const voltageHandle = document.getElementById('voltage-handle');
        const voltageValue = document.getElementById('voltage-value');
        
        const resistanceSlider = document.getElementById('resistance-slider');
        const resistanceHandle = document.getElementById('resistance-handle');
        const resistanceValue = document.getElementById('resistance-value');
        
        const currentValue = document.getElementById('current-value');
        const resistorElement = document.getElementById('resistor');
        
        const varV = document.getElementById('var-v');
        const varI = document.getElementById('var-i');
        const varR = document.getElementById('var-r');
        
        const arrow1 = document.getElementById('arrow1');
        const arrow2 = document.getElementById('arrow2');
        
        const quizToggleBtn = document.getElementById('quiz-toggle-btn');
        const quizContainer = document.getElementById('quiz-container');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.getElementById('quiz-options');
        const explanation = document.getElementById('explanation');
        const checkAnswerBtn = document.getElementById('check-answer');
        const nextQuestionBtn = document.getElementById('next-question');
        const scoreboard = document.getElementById('scoreboard');
        const scoreDisplay = document.getElementById('score');
        
        // Initialize positions
        updateVoltageHandle();
        updateResistanceHandle();
        updateCurrent();
        
        // Event listeners for dragging sliders
        let isDraggingVoltage = false;
        let isDraggingResistance = false;
        
        voltageHandle.addEventListener('mousedown', () => {
            if (!isQuizMode) isDraggingVoltage = true;
        });
        
        resistanceHandle.addEventListener('mousedown', () => {
            if (!isQuizMode) isDraggingResistance = true;
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDraggingVoltage) handleVoltageDrag(e);
            if (isDraggingResistance) handleResistanceDrag(e);
        });
        
        document.addEventListener('mouseup', () => {
            isDraggingVoltage = false;
            isDraggingResistance = false;
        });
        
        // Touch support
        voltageHandle.addEventListener('touchstart', (e) => {
            if (!isQuizMode) {
                isDraggingVoltage = true;
                e.preventDefault();
            }
        });
        
        resistanceHandle.addEventListener('touchstart', (e) => {
            if (!isQuizMode) {
                isDraggingResistance = true;
                e.preventDefault();
            }
        });
        
        document.addEventListener('touchmove', (e) => {
            if (isDraggingVoltage && e.touches.length > 0) {
                handleVoltageDrag(e.touches[0]);
                e.preventDefault();
            }
            if (isDraggingResistance && e.touches.length > 0) {
                handleResistanceDrag(e.touches[0]);
                e.preventDefault();
            }
        });
        
        document.addEventListener('touchend', () => {
            isDraggingVoltage = false;
            isDraggingResistance = false;
        });
        
        // Keyboard support for sliders
        voltageHandle.addEventListener('keydown', (e) => {
            if (isQuizMode) return;
            if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                voltage = Math.min(10, voltage + 0.1);
                updateVoltageHandle();
                updateCurrent();
                e.preventDefault();
            } else if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') {
                voltage = Math.max(0.5, voltage - 0.1);
                updateVoltageHandle();
                updateCurrent();
                e.preventDefault();
            }
        });
        
        resistanceHandle.addEventListener('keydown', (e) => {
            if (isQuizMode) return;
            if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                resistance = Math.min(1000, resistance + 10);
                updateResistanceHandle();
                updateCurrent();
                e.preventDefault();
            } else if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') {
                resistance = Math.max(10, resistance - 10);
                updateResistanceHandle();
                updateCurrent();
                e.preventDefault();
            }
        });
        
        // Drag handlers
        function handleVoltageDrag(e) {
            const rect = voltageSlider.getBoundingClientRect();
            const y = Math.max(0, Math.min(1, 1 - (e.clientY - rect.top) / rect.height));
            voltage = 0.5 + y * 9.5; // Range from 0.5V to 10V
            updateVoltageHandle();
            updateCurrent();
        }
        
        function handleResistanceDrag(e) {
            const rect = resistanceSlider.getBoundingClientRect();
            const y = Math.max(0, Math.min(1, 1 - (e.clientY - rect.top) / rect.height));
            resistance = 10 + y * 990; // Range from 10Ω to 1000Ω
            updateResistanceHandle();
            updateCurrent();
        }
        
        // Update UI
        function updateVoltageHandle() {
            const percentage = (voltage - 0.5) / 9.5;
            const position = 130 - (percentage * 130);
            voltageHandle.style.top = `${position}px`;
            voltageValue.textContent = voltage.toFixed(1);
            voltageSlider.setAttribute('aria-valuenow', voltage.toFixed(1));
        }
        
        function updateResistanceHandle() {
            const percentage = (resistance - 10) / 990;
            const position = 130 - (percentage * 130);
            resistanceHandle.style.top = `${position}px`;
            resistanceValue.textContent = Math.round(resistance);
            resistanceSlider.setAttribute('aria-valuenow', Math.round(resistance));
        }
        
        function updateCurrent() {
            current = voltage / resistance * 1000; // in mA
            currentValue.textContent = current.toFixed(1);
            
            // Update equation visualization sizes
            const vSize = 30 + (voltage / 10) * 40;
            const rSize = 30 + (resistance / 1000) * 40;
            const iSize = 30 + (current / 100) * 30;
            
            varV.style.fontSize = `${vSize}px`;
            varR.style.fontSize = `${rSize}px`;
            varI.style.fontSize = `${iSize}px`;
            
            // Update resistor visualization
            const opacity = Math.min(1, Math.max(0.2, resistance / 500));
            resistorElement.style.opacity = opacity;
            
            // Update current flow animation
            const flowSpeed = Math.max(0.2, Math.min(4, current / 20));
            const duration = 1.5 / flowSpeed;
            arrow1.style.animation = `moveArrow ${duration}s linear infinite`;
            arrow2.style.animation = `moveArrow ${duration}s linear ${duration/2}s infinite`;
        }
        
        // Quiz mode toggle
        quizToggleBtn.addEventListener('click', () => {
            isQuizMode = !isQuizMode;
            quizToggleBtn.textContent = `Quiz Mode: ${isQuizMode ? 'On' : 'Off'}`;
            
            if (isQuizMode) {
                quizContainer.style.display = 'block';
                scoreboard.style.display = 'block';
                voltageSlider.style.pointerEvents = 'none';
                resistanceSlider.style.pointerEvents = 'none';
                voltageHandle.style.opacity = '0.5';
                resistanceHandle.style.opacity = '0.5';
                generateQuizQuestion();
            } else {
                quizContainer.style.display = 'none';
                scoreboard.style.display = 'none';
                voltageSlider.style.pointerEvents = 'auto';
                resistanceSlider.style.pointerEvents = 'auto';
                voltageHandle.style.opacity = '1';
                resistanceHandle.style.opacity = '1';
                resetSimulation();
            }
        });
        
        function generateQuizQuestion() {
            explanation.style.display = 'none';
            checkAnswerBtn.disabled = true;
            checkAnswerBtn.style.display = 'block';
            nextQuestionBtn.style.display = 'none';
            selectedOptionIndex = null;
            quizOptions.innerHTML = '';
            optionElements = [];
            
            // Randomly select voltage and resistance
            voltage = (Math.random() * 9.5 + 0.5).toFixed(1); // 0.5V to 10V
            resistance = Math.round(Math.random() * 990 + 10); // 10Ω to 1000Ω
            correctAnswer = (voltage / resistance * 1000).toFixed(1); // in mA
            
            quizQuestion.textContent = `Calculate the current (I) when voltage (V) = ${voltage} V and resistance (R) = ${resistance} Ω.`;
            
            // Generate multiple-choice options
            const options = [parseFloat(correctAnswer)];
            while (options.length < 4) {
                const offset = (Math.random() * 20 - 10).toFixed(1);
                const wrongAnswer = (parseFloat(correctAnswer) + parseFloat(offset)).toFixed(1);
                if (!options.includes(parseFloat(wrongAnswer)) && parseFloat(wrongAnswer) >= 0) {
                    options.push(parseFloat(wrongAnswer));
                }
            }
            options.sort(() => Math.random() - 0.5);
            
            options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = `${option} mA`;
                optionElement.dataset.index = index;
                optionElement.dataset.value = option;
                optionElement.tabIndex = 0;
                optionElement.setAttribute('role', 'radio');
                optionElement.setAttribute('aria-checked', 'false');
                
                optionElement.addEventListener('click', () => {
                    optionElements.forEach(el => {
                        el.classList.remove('selected');
                        el.setAttribute('aria-checked', 'false');
                    });
                    optionElement.classList.add('selected');
                    optionElement.setAttribute('aria-checked', 'true');
                    selectedOptionIndex = index;
                    checkAnswerBtn.disabled = false;
                });
                
                optionElement.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        optionElement.click();
                    }
                });
                
                quizOptions.appendChild(optionElement);
                optionElements.push(optionElement);
            });
            
            // Update circuit visualization
            updateVoltageHandle();
            updateResistanceHandle();
            updateCurrent();
            optionElements[0].focus();
        }
        
        checkAnswerBtn.addEventListener('click', () => {
            if (selectedOptionIndex === null) return;
            
            const selectedOption = optionElements[selectedOptionIndex];
            const selectedValue = parseFloat(selectedOption.dataset.value);
            
            optionElements.forEach(option => {
                option.classList.remove('correct', 'incorrect');
                if (parseFloat(option.dataset.value) === parseFloat(correctAnswer)) {
                    option.classList.add('correct');
                }
            });
            
            if (selectedValue === parseFloat(correctAnswer)) {
                score += 10;
                scoreDisplay.textContent = score;
                explanation.innerHTML = `<strong>Correct!</strong> I = V / R = ${voltage} V / ${resistance} Ω = ${correctAnswer} mA.`;
            } else {
                selectedOption.classList.add('incorrect');
                explanation.innerHTML = `<strong>Incorrect.</strong> I = V / R = ${voltage} V / ${resistance} Ω = ${correctAnswer} mA.`;
            }
            
            explanation.style.display = 'block';
            checkAnswerBtn.style.display = 'none';
            nextQuestionBtn.style.display = 'block';
            optionElements.forEach(option => {
                option.style.pointerEvents = 'none';
                option.setAttribute('aria-disabled', 'true');
            });
            nextQuestionBtn.focus();
        });
        
        nextQuestionBtn.addEventListener('click', generateQuizQuestion);
        
        // Refresh button
        const refreshBtn = document.querySelector('.refresh-btn');
        refreshBtn.addEventListener('click', resetSimulation);
        refreshBtn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                resetSimulation();
            }
        });
        
        function resetSimulation() {
            voltage = 4.5;
            resistance = 78;
            updateVoltageHandle();
            updateResistanceHandle();
            updateCurrent();
            if (isQuizMode) {
                quizToggleBtn.click();
            }
        }

        function showPopup() {
        document.getElementById('popup').style.display = 'block';
        }

        
function closePopup() {
    document.getElementById('popup').style.display = 'none';
    // Stop audio if playing
    if (window.ttsAudio) {
        window.ttsAudio.pause();
        window.ttsAudio = null;
    }
}

        document.getElementById('learnButton').addEventListener('click', showPopup);
    
// Add TTS button event listener when document is ready
document.addEventListener('DOMContentLoaded', function() {
    const ttsButton = document.getElementById('ttsButton');
    if (ttsButton) {
        ttsButton.addEventListener('click', speakText);
    }
});
    
// TTS functionality
async function speakText() {
    const ttsButton = document.getElementById('ttsButton');
    const ttsStatus = document.getElementById('tts-status');
    const textToSpeak = document.getElementById('popup-content').textContent;
    
    // If audio is already playing, stop it
    if (window.ttsAudio && !window.ttsAudio.paused) {
        ttsStatus.textContent = 'বন্ধ করা হচ্ছে...';
        window.ttsAudio.pause();
        window.ttsAudio = null;
        ttsButton.style.backgroundColor = '#4CAF50';
        ttsButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            শুনুন
        `;
        ttsStatus.textContent = '';
        return;
    }
    
    try {
        ttsButton.style.backgroundColor = '#ff9800';
        ttsButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            <span class="loading-dots">লোড হচ্ছে</span>
        `;
        ttsStatus.textContent = '';
        
        // Call the backend TTS API
        const response = await fetch('http://localhost:5000/api/tts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                text: textToSpeak,
                language: 'bn-IN',  // Bengali language code
                voice: 'bn-IN-TanishaaNeural'  // Bengali voice
            })
        });
        
        if (!response.ok) {
            throw new Error(`TTS request failed: ${response.status} ${response.statusText}`);
        }
        
        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        ttsStatus.textContent = '';
        
        // Create and play audio
        const audio = new Audio(audioUrl);
        window.ttsAudio = audio;
        
        audio.addEventListener('ended', () => {
            ttsButton.style.backgroundColor = '#4CAF50';
            ttsButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                    <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                </svg>
                শুনুন
            `;
            ttsStatus.textContent = '';
            window.ttsAudio = null;
            
            // Clean up
            URL.revokeObjectURL(audioUrl);
        });
        
        audio.addEventListener('error', (e) => {
            console.error('Audio playback error:', e);
            ttsButton.style.backgroundColor = '#f44336';
            ttsButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                    <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                </svg>
                ত্রুটি হয়েছে
            `;
            
            // Clean up
            URL.revokeObjectURL(audioUrl);
            
            setTimeout(() => {
                ttsButton.style.backgroundColor = '#4CAF50';
                ttsButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    শুনুন
                `;
                ttsStatus.textContent = '';
            }, 3000);
        });
        
        ttsButton.style.backgroundColor = '#ff5722';
        ttsButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            থামান
        `;
        await audio.play();
    } catch (error) {
        console.error('TTS API error:', error);
        
        // Try using browser's built-in speech synthesis as fallback
        if (window.speechSynthesis) {
            try {
                ttsStatus.textContent = '';
                ttsButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <circle cx="18" cy="12" r="4" fill="currentColor"></circle>
                    </svg>
                    ব্রাউজারে চলছে
                `;
                
                // Find Bengali voice if available
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.lang = 'bn-IN';
                
                // Try to find a Bengali voice
                const voices = speechSynthesis.getVoices();
                const bengaliVoice = voices.find(voice => 
                    voice.lang.includes('bn') || 
                    voice.name.toLowerCase().includes('bengali')
                );
                
                if (bengaliVoice) {
                    utterance.voice = bengaliVoice;
                }
                
                utterance.onend = () => {
                    ttsButton.style.backgroundColor = '#4CAF50';
                    ttsButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                        শুনুন
                    `;
                    ttsStatus.textContent = '';
                };
                
                utterance.onerror = () => {
                    ttsButton.style.backgroundColor = '#f44336';
                    ttsButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                        </svg>
                        ত্রুটি হয়েছে
                    `;
                    setTimeout(() => {
                        ttsButton.style.backgroundColor = '#4CAF50';
                        ttsButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                            </svg>
                            শুনুন
                        `;
                        ttsStatus.textContent = '';
                    }, 3000);
                };
                
                ttsButton.style.backgroundColor = '#ff5722';
                speechSynthesis.speak(utterance);
            } catch (synthError) {
                console.error('Speech synthesis error:', synthError);
                ttsButton.style.backgroundColor = '#f44336';
                ttsButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                    </svg>
                    সমর্থিত নয়
                `;
                setTimeout(() => {
                    ttsButton.style.backgroundColor = '#4CAF50';
                    ttsButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                        </svg>
                        শুনুন
                    `;
                    ttsStatus.textContent = '';
                }, 3000);
            }
        } else {
            ttsButton.style.backgroundColor = '#f44336';
            ttsButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                    <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                </svg>
                সমর্থিত নয়
            `;
            setTimeout(() => {
                ttsButton.style.backgroundColor = '#4CAF50';
                ttsButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    শুনুন
                `;
                ttsStatus.textContent = '';
            }, 3000);
        }
    }
}
</script>

<style>
    @keyframes loading-dots {
        0%, 20% { content: ""; }
        40% { content: "."; }
        60% { content: ".."; }
        80%, 100% { content: "..."; }
    }
    
    .loading-dots::after {
        content: "";
        animation: loading-dots 1.5s infinite;
        display: inline-block;
    }
    
    #ttsButton {
        transition: background-color 0.3s, transform 0.2s;
        font-weight: 500;
        display: flex;
        align-items: center;
    }
    
    #ttsButton:hover {
        background-color: #3e8e41 !important;
        transform: translateY(-1px);
    }
    
    #ttsButton:active {
        transform: scale(0.98);
    }
    
    #tts-status {
        transition: opacity 0.3s;
    }
</style>
    <div id="popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border: 1px solid black; z-index: 1001; max-width: 500px; text-align: justify;">
    <p id="popup-content">ওহমের সূত্র বৈদ্যুতিক বর্তনীতে ব্যবহৃত একটি গুরুত্বপূর্ণ নিয়ম, যা জার্মান বিজ্ঞানী জর্জ সাইমন ওহম প্রস্তাব করেন। এই সূত্র অনুযায়ী, একটি পরিবাহকের দুই প্রান্তের বিভব পার্থক্য (V) এবং তাতে প্রবাহিত কারেন্টের পরিমাণ (I) পরস্পরের সমানুপাতিক, যদি তাপমাত্রা এবং অন্যান্য শারীরিক অবস্থা অপরিবর্তিত থাকে। সূত্রটি হলো: V = I × R, যেখানে V হলো বিভব পার্থক্য (ভোল্টে), I হলো কারেন্ট বা বিদ্যুৎপ্রবাহ (অ্যাম্পিয়ারে), এবং R হলো প্রতিবন্ধকতা বা রেজিস্ট্যান্স (ওহমে)। এই সূত্রের সাহায্যে আমরা সহজেই জানতে পারি কোনো বৈদ্যুতিক যন্ত্রে কতটা বিদ্যুৎপ্রবাহ প্রবাহিত হচ্ছে বা তার প্রতিবন্ধকতা কত।</p>
    
<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
    <button id="ttsButton" style="display: flex; align-items: center; background-color: #4CAF50; color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);" title="শুনুন" aria-label="Read aloud">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
            <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
        </svg>
        শুনুন
    </button>
    <div id="tts-status" style="color: #666; font-size: 14px; min-height: 20px; flex-grow: 1; text-align: center;"></div>
    <button onclick="closePopup()" style="background-color: #f44336; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer;">বন্ধ করুন</button>
</div>
</body>
</html>